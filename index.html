<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>T-Shirt Designer</title>
    <script src="https://cdn.jsdelivr.net/npm/konva@9.0.1/konva.min.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f4f4f4;
      }

      header {
        text-align: center;
        padding: 20px;
        background-color: #333;
        color: white;
        font-size: 24px;
        font-weight: bold;
      }

      #main-container {
        display: flex;
        max-width: 1200px;
        margin: 20px auto;
        background-color: white;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      #controls {
        flex: 1;
        padding: 20px;
        background-color: #f9f9f9;
        border-right: 1px solid #ddd;
      }

      #controls label {
        font-weight: bold;
        margin-top: 10px;
        display: block;
      }

      #controls input,
      #controls select,
      #controls button {
        width: 100%;
        padding: 10px;
        margin-bottom: 15px;
        border-radius: 5px;
        border: 1px solid #ccc;
        font-size: 16px;
      }

      #controls button {
        background-color: #007bff;
        color: white;
        border: none;
        cursor: pointer;
        transition: background-color 0.3s ease;
      }

      #controls button:hover {
        background-color: #0056b3;
      }

      #canvas-container {
        flex: 2;
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      #tshirt-container {
        width: 500px;
        height: 600px;
        background-color: #fff;
        border: 1px solid #ddd;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      #price-container {
        margin-top: 20px;
        font-size: 20px;
        font-weight: bold;
        color: #333;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <header>T-Shirt Designer</header>

    <div id="main-container">
      <!-- Controls Section -->
      <div id="controls">
        <label>Add Text:</label>
        <input type="text" id="text-input" placeholder="Enter text here" />
        <button onclick="addText()">Add Text</button>

        <label>Upload Image:</label>
        <input type="file" id="upload-image" />

        <label>Font Size:</label>
        <input type="number" id="font-size-input" value="24" />

        <label>Font Color:</label>
        <input type="color" id="font-color-input" value="#000000" />

        <label>Font Style:</label>
        <select id="font-family-input">
          <option value="Arial">Arial</option>
          <option value="Comic Sans MS">Comic Sans</option>
          <option value="Courier New">Courier</option>
          <option value="Georgia">Georgia</option>
        </select>
        <button onclick="applyTextStyles()">Apply Styles</button>

        <label>T-Shirt Background Color:</label>
        <input type="color" id="tshirt-color-picker" value="#ffffff" />
        <button onclick="exportDesign()">Export Design</button>
        <button onclick="toggleView()">Switch to Back View</button>
        <button onclick="deselectElement()">Deselect Element</button>
      </div>

      <!-- Canvas Section -->
      <div id="canvas-container">
        <div id="tshirt-container"></div>
        <div id="price-container">
          Total Price: <span id="price">10</span> USD
        </div>
      </div>
    </div>

    <script>
      const stage = new Konva.Stage({
        container: "tshirt-container",
        width: 500,
        height: 600,
      });

      const frontLayer = new Konva.Layer();
      const backLayer = new Konva.Layer();
      stage.add(frontLayer);
      stage.add(backLayer);

      backLayer.visible(false);

      let selectedElement = null;

      // Load T-Shirt Templates
      Konva.Image.fromURL("./tshirt-front-template.png", (frontTemplate) => {
        frontTemplate.setAttrs({
          x: 0,
          y: 0,
          width: 500,
          height: 600,
          draggable: false,
        });
        frontLayer.add(frontTemplate);
        frontLayer.draw();
      });

      Konva.Image.fromURL("./tshirt-back-template.png", (backTemplate) => {
        backTemplate.setAttrs({
          x: 0,
          y: 0,
          width: 500,
          height: 600,
          draggable: false,
        });
        backLayer.add(backTemplate);
        backLayer.draw();
      });

      // Add Text
      function addText() {
        const textValue = document.getElementById("text-input").value;
        if (!textValue) {
          alert("Please enter some text!");
          return;
        }

        const activeLayer = frontLayer.visible() ? frontLayer : backLayer;

        const text = new Konva.Text({
          x: 50,
          y: 50,
          text: textValue,
          fontSize: 24,
          fill: "black",
          draggable: true,
        });

        activeLayer.add(text);
        activeLayer.draw();

        calculatePrice();
      }

      // Handle Selection
      stage.on("click", (e) => {
        if (e.target === stage) {
          deselectElement();
          return;
        }

        if (e.target.getClassName() === "Text" || e.target.getClassName() === "Image") {
          if (selectedElement) {
            selectedElement.stroke(null);
            selectedElement.strokeWidth(0);
          }

          selectedElement = e.target;
          selectedElement.stroke("red");
          selectedElement.strokeWidth(2);

          selectedElement.getLayer().draw();
        }
      });

      // Handle Image Upload
      document.getElementById("upload-image").addEventListener("change", (e) => {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = () => {
          const activeLayer = frontLayer.visible() ? frontLayer : backLayer;

          Konva.Image.fromURL(reader.result, (image) => {
            image.setAttrs({
              x: 50,
              y: 50,
              width: 150,
              height: 150,
              draggable: true,
            });

            activeLayer.add(image);
            activeLayer.draw();
            calculatePrice();
          });
        };
        reader.readAsDataURL(file);
      });

      // Apply Text Styles
      function applyTextStyles() {
        if (!selectedElement || selectedElement.getClassName() !== "Text") {
          alert("Please select a text element to apply styles.");
          return;
        }

        const fontSize = document.getElementById("font-size-input").value;
        const fontColor = document.getElementById("font-color-input").value;
        const fontFamily = document.getElementById("font-family-input").value;

        selectedElement.fontSize(fontSize);
        selectedElement.fill(fontColor);
        selectedElement.fontFamily(fontFamily);

        selectedElement.getLayer().draw();
      }

      // Deselect Element
      function deselectElement() {
        if (selectedElement) {
          selectedElement.stroke(null);
          selectedElement.strokeWidth(0);
          selectedElement.getLayer().draw();
          selectedElement = null;
        }
      }

      // Export the Design
      function exportDesign() {
        const dataURL = stage.toDataURL();
        const link = document.createElement("a");
        link.download = "tshirt-design.png";
        link.href = dataURL;
        link.click();
      }

      // Switch Views
      function toggleView() {
        const isFrontVisible = frontLayer.visible();
        frontLayer.visible(!isFrontVisible);
        backLayer.visible(isFrontVisible);
        stage.draw();
      }

      // Calculate Pricing
      function calculatePrice() {
        const activeLayer = frontLayer.visible() ? frontLayer : backLayer;
        const textCount = activeLayer.find("Text").length;
        const imageCount = activeLayer.find("Image").length;
        const totalPrice = 10 + textCount * 2 + imageCount * 3;
        document.getElementById("price").textContent = totalPrice;
      }
    </script>
  </body>
</html>
