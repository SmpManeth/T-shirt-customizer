<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>T-Shirt Designer</title>
  <script src="https://cdn.jsdelivr.net/npm/konva@9.0.1/konva.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    #tshirt-container {
      border: 1px solid #ddd;
      margin: 20px 0;
    }
    #controls {
      margin-bottom: 20px;
    }
    #toggle-view {
      margin-top: 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>T-Shirt Designer</h1>

  <!-- Controls -->
  <div id="controls">
    <label>
      Add Text: 
      <input type="text" id="text-input" placeholder="Enter text" />
      <button onclick="addText()">Add</button>
    </label>
    <br><br>
    <label>
      Upload Image: 
      <input type="file" id="upload-image" />
    </label>
    <br><br>
    <button onclick="exportDesign()">Export Design</button>
    <br><br>
    <button id="toggle-view" onclick="toggleView()">Switch to Back View</button>
  </div>

  <!-- Canvas for T-Shirt -->
  <div id="tshirt-container" style="width: 500px; height: 600px;"></div>

  <script>
    // Step 1: Initialize Konva Stage
    const stage = new Konva.Stage({
      container: 'tshirt-container',
      width: 500,
      height: 600,
    });

    // Step 2: Create Separate Layers for Front and Back Views
    const frontLayer = new Konva.Layer();
    const backLayer = new Konva.Layer();

    stage.add(frontLayer);
    stage.add(backLayer);

    // Initially show the front view
    backLayer.visible(false);

    // Step 3: Add T-Shirt Templates for Front and Back
    Konva.Image.fromURL('./tshirt-front-template.png', (frontTemplate) => {
      frontTemplate.setAttrs({
        x: 0,
        y: 0,
        width: 500,
        height: 600,
        draggable: false,
      });
      frontLayer.add(frontTemplate);
      frontLayer.draw();
    });

    Konva.Image.fromURL('./tshirt-back-template.png', (backTemplate) => {
      backTemplate.setAttrs({
        x: 0,
        y: 0,
        width: 500,
        height: 600,
        draggable: false,
      });
      backLayer.add(backTemplate);
      backLayer.draw();
    });

    // Step 4: Add Text to Active Layer
    function addText() {
      const textValue = document.getElementById('text-input').value;
      if (!textValue) return alert('Please enter some text.');

      const activeLayer = frontLayer.visible() ? frontLayer : backLayer;

      const text = new Konva.Text({
        x: 50,
        y: 50,
        text: textValue,
        fontSize: 24,
        fill: 'black',
        draggable: true,
      });

      activeLayer.add(text);
      activeLayer.draw();
    }

    // Step 5: Add Uploaded Image to Active Layer
    document.getElementById('upload-image').addEventListener('change', function (event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function () {
        const activeLayer = frontLayer.visible() ? frontLayer : backLayer;

        Konva.Image.fromURL(reader.result, (uploadedImage) => {
          uploadedImage.setAttrs({
            x: 100,
            y: 100,
            width: 150,
            height: 150,
            draggable: true,
          });
          activeLayer.add(uploadedImage);
          activeLayer.draw();
        });
      };
      reader.readAsDataURL(file);
    });

    // Step 6: Export the Current Design
    function exportDesign() {
      const activeLayer = frontLayer.visible() ? 'front' : 'back';
      const dataURL = stage.toDataURL();

      const link = document.createElement('a');
      link.download = `tshirt-design-${activeLayer}.png`;
      link.href = dataURL;
      link.click();
    }

    // Step 7: Toggle Between Front and Back Views
    function toggleView() {
      if (frontLayer.visible()) {
        frontLayer.visible(false);
        backLayer.visible(true);
        document.getElementById('toggle-view').innerText = 'Switch to Front View';
      } else {
        frontLayer.visible(true);
        backLayer.visible(false);
        document.getElementById('toggle-view').innerText = 'Switch to Back View';
      }
      stage.draw(); // Re-render the stage
    }
  </script>
</body>
</html>
