<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>T-Shirt Designer</title>
    <script src="https://cdn.jsdelivr.net/npm/konva@9.0.1/konva.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-100 font-sans">
    <header class="bg-gray-800 text-white text-center py-4 text-2xl font-bold">
      T-Shirt Designer
    </header>

    <div class="max-w-7xl mx-auto mt-6 p-4 bg-white rounded-lg shadow-lg flex">
      <!-- Controls Section -->
      <div class="w-1/3 p-4 border-r border-gray-300">
        <label class="block font-semibold mb-2">Add Text:</label>
        <input
          type="text"
          id="text-input"
          class="w-full mb-4 p-2 border rounded"
          placeholder="Enter text here"
        />
        <button
          onclick="addText()"
          class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 rounded mb-4"
        >
          Add Text
        </button>

        <label class="block font-semibold mb-2">Upload Image:</label>
        <input type="file" id="upload-image" class="w-full mb-4 p-2 border rounded" />

        <label class="block font-semibold mb-2">Font Size:</label>
        <input
          type="number"
          id="font-size-input"
          value="24"
          class="w-full mb-4 p-2 border rounded"
        />

        <label class="block font-semibold mb-2">Font Color:</label>
        <input
          type="color"
          id="font-color-input"
          value="#000000"
          class="w-full mb-4 p-2 border rounded"
        />

        <label class="block font-semibold mb-2">Font Style:</label>
        <select
          id="font-family-input"
          class="w-full mb-4 p-2 border rounded"
        >
          <option value="Arial">Arial</option>
          <option value="Comic Sans MS">Comic Sans</option>
          <option value="Courier New">Courier</option>
          <option value="Georgia">Georgia</option>
        </select>
        <button
          onclick="applyTextStyles()"
          class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 rounded mb-4"
        >
          Apply Styles
        </button>

        <label class="block font-semibold mb-2">T-Shirt Background Color:</label>
        <input
          type="color"
          id="tshirt-color-picker"
          value="#ffffff"
          class="w-full mb-4 p-2 border rounded"
        />
        <button
          onclick="exportDesign()"
          class="w-full bg-green-500 hover:bg-green-600 text-white py-2 rounded mb-4"
        >
          Export Design
        </button>
        <button
          onclick="toggleView()"
          class="w-full bg-purple-500 hover:bg-purple-600 text-white py-2 rounded mb-4"
        >
          Switch to Back View
        </button>
        <button
          onclick="deselectElement()"
          class="w-full bg-gray-500 hover:bg-gray-600 text-white py-2 rounded"
        >
          Deselect Element
        </button>
      </div>

      <!-- Canvas Section -->
      <div class="w-2/3 flex flex-col items-center p-4">
        <div
          id="tshirt-container"
          class="w-96 h-[600px] bg-gray-50 border border-gray-300 shadow-md"
        ></div>
        <div class="mt-4 text-lg font-bold text-gray-700">
          Total Price: <span id="price" class="text-blue-600">10</span> USD
        </div>
      </div>
    </div>

    <script>
      const stage = new Konva.Stage({
        container: "tshirt-container",
        width: 500,
        height: 600,
      });

      const frontLayer = new Konva.Layer();
      const backLayer = new Konva.Layer();
      stage.add(frontLayer);
      stage.add(backLayer);

      backLayer.visible(false);

      let selectedElement = null;

      // Load T-Shirt Templates
      Konva.Image.fromURL("./tshirt-front-template.png", (frontTemplate) => {
        frontTemplate.setAttrs({
          x: 0,
          y: 0,
          width: 500,
          height: 600,
          draggable: false,
        });
        frontLayer.add(frontTemplate);
        frontLayer.draw();
      });

      Konva.Image.fromURL("./tshirt-back-template.png", (backTemplate) => {
        backTemplate.setAttrs({
          x: 0,
          y: 0,
          width: 500,
          height: 600,
          draggable: false,
        });
        backLayer.add(backTemplate);
        backLayer.draw();
      });

      // Add Text
      function addText() {
        const textValue = document.getElementById("text-input").value;
        if (!textValue) {
          alert("Please enter some text!");
          return;
        }

        const activeLayer = frontLayer.visible() ? frontLayer : backLayer;

        const text = new Konva.Text({
          x: 50,
          y: 50,
          text: textValue,
          fontSize: 24,
          fill: "black",
          draggable: true,
        });

        activeLayer.add(text);
        activeLayer.draw();

        calculatePrice();
      }

      // Handle Selection
      stage.on("click", (e) => {
        if (e.target === stage) {
          deselectElement();
          return;
        }

        if (e.target.getClassName() === "Text" || e.target.getClassName() === "Image") {
          if (selectedElement) {
            selectedElement.stroke(null);
            selectedElement.strokeWidth(0);
          }

          selectedElement = e.target;
          selectedElement.stroke("red");
          selectedElement.strokeWidth(2);

          selectedElement.getLayer().draw();
        }
      });

      // Handle Image Upload
      document.getElementById("upload-image").addEventListener("change", (e) => {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = () => {
          const activeLayer = frontLayer.visible() ? frontLayer : backLayer;

          Konva.Image.fromURL(reader.result, (image) => {
            image.setAttrs({
              x: 50,
              y: 50,
              width: 150,
              height: 150,
              draggable: true,
            });

            activeLayer.add(image);
            activeLayer.draw();
            calculatePrice();
          });
        };
        reader.readAsDataURL(file);
      });

      // Apply Text Styles
      function applyTextStyles() {
        if (!selectedElement || selectedElement.getClassName() !== "Text") {
          alert("Please select a text element to apply styles.");
          return;
        }

        const fontSize = document.getElementById("font-size-input").value;
        const fontColor = document.getElementById("font-color-input").value;
        const fontFamily = document.getElementById("font-family-input").value;

        selectedElement.fontSize(fontSize);
        selectedElement.fill(fontColor);
        selectedElement.fontFamily(fontFamily);

        selectedElement.getLayer().draw();
      }

      // Deselect Element
      function deselectElement() {
        if (selectedElement) {
          selectedElement.stroke(null);
          selectedElement.strokeWidth(0);
          selectedElement.getLayer().draw();
          selectedElement = null;
        }
      }

      // Export the Design
      function exportDesign() {
        const dataURL = stage.toDataURL();
        const link = document.createElement("a");
        link.download = "tshirt-design.png";
        link.href = dataURL;
        link.click();
      }

      // Switch Views
      function toggleView() {
        const isFrontVisible = frontLayer.visible();
        frontLayer.visible(!isFrontVisible);
        backLayer.visible(isFrontVisible);
        stage.draw();
      }

      // Calculate Pricing
      function calculatePrice() {
        const activeLayer = frontLayer.visible() ? frontLayer : backLayer;
        const textCount = activeLayer.find("Text").length;
        const imageCount = activeLayer.find("Image").length;
        const totalPrice = 10 + textCount * 2 + imageCount * 3;
        document.getElementById("price").textContent = totalPrice;
      }
    </script>
  </body>
</html>
